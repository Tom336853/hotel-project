<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}"/>
    <link rel="stylesheet" th:href="@{/lib/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/animate.min.css}">
    <link rel="stylesheet" th:href="@{/iconfont/iconfont.css}">
</head>

<body>

<div class="page-loading">
    <div class="rubik-loader"></div>
</div>

<div class="z-body animated fadeIn">

    <table class="layui-hide" id="user-table"></table>
</div>

<script type="text/html" id="toolbar">

</script>

<script type="text/html" id="column-toolbar">
    <a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">完成</a>

    <a lay-event="del">
        <i class="zadmin-icon zadmin-icon-delete zadmin-oper-area zadmin-red" title="删除"></i>
    </a>
</script>


<script th:src="@{/lib/jquery/jquery.min.js}"></script>
<script th:src="@{/lib/layui/layui.js}"></script>
<script th:src="@{/js/common.js}"></script>

<script>
    layui.config({
        base: '/lib/layui/extend/'
    }).use(['table', 'element', 'form', 'dtree', 'tablePlug'], function () {
        var table = layui.table;
        var $ = layui.$;
        var form = layui.form;
        var tablePlug = layui.tablePlug;

        tablePlug.smartReload.enable(true);

        table.render({
            elem: '#user-table'
            , url: '/restaurantOrder/list'
            , page: true
            , toolbar: '#toolbar'
            , smartReloadModel: true
            , cols: [
                [
                    {type: 'numbers', title: '序号', width: "5%"}
                    ,{field: 'id', title: 'ID', width: "5%", hide: true}
                    , {field: 'orderNo', title: '订单号', width: "10%"}
                    , {field: 'roomNo', title: '餐厅号', width: "7%"}
                    , {field: 'userId', title: '用户id', width: "7%"}
                    , {field: 'startTime', title: '日期', width: "10%"}
                    , {field: 'customerName', title: '预约人', width: "10%"}
                    , {field: 'customerPhone', title: '手机号', width: "10%"}
                    , {field: 'price', title: '价格', width: "5%"}
                    , {field: 'status', title: '状态', width: "7%"}
                    , {title: '操作', align: 'center', width: "15%", toolbar: '#column-toolbar'}
                ]
            ]
        });

        // 工具条点击事件
        table.on('toolbar', function (obj) {
            var data = obj.data;
            var event = obj.event;

        });

        // 行点击事件 重置密码
        table.on('tool', function (obj) {
            var data = obj.data;
            var event = obj.event;
            if (event === 'edit') {
                edit(data.id);
            } else if (event === 'del') {
                del(obj);
            }
        });

        function del(obj) {
            layer.confirm("你确定要删除吗？", {icon: 3, title: '提示'},
                function (index) {//确定回调
                    var id = obj.data.id;
                    $.post('/restaurantOrder/' + id, {_method: "DELETE"}, function (data) {
                        layer.close(index);
                        handlerResult(data, deleteDone);
                    });
                }, function (index) {//取消回调
                    layer.close(index);
                }
            );
        }

        function deleteDone(data) {
            parent.layer.msg("删除成功", {icon: 6});
            table.reload('user-table');
        }

        function successDone(data) {
            parent.layer.msg("完成成功", {icon: 6});
            table.reload('user-table');
        }

        function edit(id) {
            layer.confirm("你确定要完成吗？", {icon: 3, title: '提示'},
                function (index) {//确定回调
                    $.post('/restaurantOrder/update/' + id, {_method: "POST"}, function (data) {
                        layer.close(index);
                        handlerResult(data, successDone);
                    });
                }, function (index) {//取消回调
                    layer.close(index);
                }
            );
        }

        form.on('submit(search)', function (form) {
            table.reload('user-table', {
                where: form.field
            });
            return false;
        });

    });
</script>
</body>

</html>