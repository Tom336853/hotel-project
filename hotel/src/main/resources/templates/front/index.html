<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" th:href="@{/res/layui/css/layui.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/res/css/main.css}">

</head>
<body>
  <div class="header">
    <div class="menu-btn">
      <div class="menu"></div>
    </div>

    <div class="nav">
      <a href="/front/index" class="active" style="color:#f1af82;">预定客房</a>
      <a href="/front/restaurant" style="color:#fff;">预定餐厅</a>
    </div>

    <p class="welcome-text">
      <span th:if="${user!=null }">
        <span class="name" style="color:#fff;">欢迎，[[${user.name}]]</span><span class="name">
        <a href="/info"><img style="border-radius:15px" height="30px" width="30px" th:src="${user.userImage}"></a>
        | </span><a href="/logout" style="color:#fff;">退出</a>
      </span>
      <span th:if="${user==null }">
          <a  href="/login" style="color:#fff;">登录</a><span class="name"> | </span><a href="/register" style="color:#fff;">注册</a>
      </span>
    </p>
  </div>


  <div class="content" style="margin-top: 20px;padding-top: 0px">
    <div class="cont w1000">
      <form method="get" action="/front/search">
        <div class="layui-input-inline">
          <select class="layui-select" name="roomType">
            <option value="">选择客房类型</option>
            <option value="大床房" >大床房</option>
            <option value="标间"  >标间</option>
            <option value="豪华套房">豪华套房</option>
            <option value="家庭房" >家庭房</option>
          </select>
        </div>
        <div class="layui-inline">
          <div class="layui-input-inline" style="width: 160px;">
            <input type="text" class="layui-input" id="startTime" name="startTime" placeholder="入住时间" th:value="${room.startTime}" readonly>
          </div>
          <div class="layui-form-mid"></div>
          <div class="layui-input-inline" style="width: 160px;">
            <input type="text" class="layui-input" id="endTime" name="endTime" placeholder="离开时间" th:value="${room.endTime}" readonly>
          </div>
        </div>
        <div class="layui-input-inline">
          <input type="submit" class="layui-btn layui-btn-normal btn-w100" lay-submit="" value="搜索">
        </div>
      </form>
      <div class="list-item" style="margin-top: 20px">
        <div class="item" th:each="room:${roomList}" style="margin-bottom: 40px">
          <div class="layui-fluid">
            <div class="layui-row">
              <div class="layui-col-xs12 layui-col-sm4 layui-col-md3">
                <div class="img" style="width: 300px;height: 200px;">
                  <img th:if="${room.roomImg!=null and room.roomImg==''}" width="300px" height="200px" th:src="@{/images/moren.jpg}" style="border-radius: 10px">
                  <img th:if="${room.roomImg!=''}" th:src="${room.roomImg }" width="300px" height="200px" style="border-radius: 10px">
                </div>
              </div>
              <div class="layui-col-xs12 layui-col-sm8 layui-col-md9">
                <div class="item-cont">
                  <span class="layui-btn layui-btn-normal layui-btn-radius"
                        style="height: 20px;line-height: 20px;width: 80px;">[[${room.roomType}]]</span>
                  <h3>￥[[${room.roomPrice}]]</h3>
                  <h4>[[${#strings.abbreviate(room.roomDesc,138)}]]</h4>
                  <div style="margin-top: 10px">
                    <button class="layui-btn layui-btn-danger" th:onclick="yuding([[${room.roomNo}]])" style="border-radius: 15px">预定</button>
                  </div>
                </div>
            </div>
            </div>
           </div>
          <hr>
        </div>
      </div>

    </div>
  </div>



  <script th:src="@{/lib/jquery/jquery.min.js}"></script>
  <script th:src="@{/lib/layui/layui.js}"></script>
  <script th:src="@{/js/common.js}"></script>

  <script type="text/javascript">
    layui.use([ 'laydate'], function() {
      var form = layui.form,
              layer = layui.layer,
              layedit = layui.layedit,
              laydate = layui.laydate;

      var dateTime = new Date();
      dateTime = dateTime.setDate(dateTime.getDate()+1);

      var endDate = laydate.render({
        elem: '#endTime',
        eventElem: '.date-input-icon',
        min:new Date().toLocaleString(),
        trigger: 'click',
        done: function(value, date) {
          startDate.config.max = {
            year: date.year,
            month: date.month - 1,
            date: date.date,
          }
        }
      });
      var startDate = laydate.render({
        elem: '#startTime',
        eventElem: '.date-input-icon',
        trigger: 'click',
        min:new Date().toLocaleString(),
        done: function(value, date) {
          endDate.config.min = {
            year: date.year,
            month: date.month - 1,
            date: date.date + 1,
          };
        }
      });
    });

    function yuding(roomNo) {
      var flag = [[${user==null}]];
      if (flag) {
        layer.msg("请先登录");
        return ;
      }

      layer.open({
        id:1,
        type: 1,
        title:'请输入预定信息',
        area:['450px', '250px'],
        content: '<div class="layui-form-item" style="margin-top: 20px">\n' +
                '                <label class="layui-form-label">\n' +
                '                    姓名\n' +
                '                </label>\n' +
                '                <div class="layui-input-block">\n' +
                '                    <input type="text" id="customerName" \n' +
                '                           lay-verify="required" lay-vertype="tips" style="width: 300px" \n' +
                '                           autocomplete="off" class="layui-input">\n' +
                '                </div>\n' +
                '            </div>\n' +
                '\n' +
                '            <div class="layui-form-item">\n' +
                '                <label class="layui-form-label">\n' +
                '                    手机号\n' +
                '                </label>\n' +
                '                <div class="layui-input-block">\n' +
                '                    <input type="text" id="customerPhone" ' +
                '                           lay-verify="required" lay-vertype="tips" style="width: 300px" \n' +
                '                           autocomplete="off" class="layui-input">\n' +
                '                </div>\n' +
                '            </div>',
        btn:['保存','取消'],
        yes:function (index,layero) {
          //获取输入框里面的值
          var customerName = $("#customerName").val();
          if (customerName=="" || customerName==null) {
            layer.msg("请输入姓名");
            return ;
          }
          var customerPhone = $("#customerPhone").val();
          if (customerPhone=="" || customerPhone==null) {
            layer.msg("请输入手机号");
            return ;
          }
          var startTime = $("#startTime").val();
          var endTime = $("#endTime").val();
          $.ajax({
            url: '/front/addRoomOrder',
            type: 'post',
            data: {"customerName":customerName,"customerPhone":customerPhone,"startTime":startTime,"endTime":endTime,"roomNo":roomNo},
            dataType: 'json',
            success: function(data) {
              handlerResult(data, addDone);
            }
          })
        },
        no:function (index,layero) {
          layer.close(index);
        }
      });
    }

    function addDone(data) {
      layer.msg("预定成功", {icon: 6});
      setTimeout('myrefresh()',1000);
    }
    function myrefresh(){
      window.location.reload();
    }

  </script>
</body>
</html>