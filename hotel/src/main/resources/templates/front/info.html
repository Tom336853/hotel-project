<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="../res/layui/css/layui.css">
  <link rel="stylesheet" type="text/css" href="../res/css/main.css">
  <script th:src="@{/lib/jquery/jquery.min.js}"></script>
  <script th:src="@{/lib/layui/layui.js}"></script>
  <script th:src="@{/js/common.js}"></script>
  <style>
    .layui-tab-title li{
      display: block;
      color: white;
      background-color: #f5b462;
    }
    .layui-tab-title{
      float: left;
      width: 200px;
    }
    .layui-tab-content{
      float: left;
      width: 500px;
    }
  </style>

</head>
<body style="background-image: url('/images/back.jpg')">
<div class="header">
  <div class="menu-btn">
    <div class="menu"></div>
  </div>

  <div class="nav">
    <a href="/front/index" style="color:#fff;">预定客房</a>
    <a href="/front/restaurant" class="active" style="color:#fff;">预定餐厅</a>
  </div>

  <p class="welcome-text">
      <span th:if="${user!=null }">
        <span class="name" style="color:#fff;">欢迎，[[${user.name}]]</span><span class="name">
        <a href="/front/getNotice" class="layui-btn layui-btn-danger layui-btn-radius" th:if="${user.noticeNumber!=0}">[[${user.noticeNumber}]]个新评论未读</a>
        <a href="/info"><img style="border-radius:15px" height="30px" width="30px" th:src="${user.userImage}"></a>
        | </span><a href="/logout" style="color:#fff;">退出</a>
      </span>
    <span th:if="${user==null }">
          <a  href="/login" style="color:#fff;">登录</a><span class="name"> | </span><a href="/register" style="color:#fff;">注册</a>
      </span>
  </p>
</div>
<div style="width: 1000px;margin: 0 auto">
  <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief" style="background-color: red;">
    <ul class="layui-tab-title">
      <li class="layui-this">我的个人信息</li>
      <li>我的客房预约</li>
      <li>我的餐厅预约</li>
    </ul>
    <div class="layui-tab-content" style="height: 1000px;width:700px;border: 2px solid #e7d7d7;background-color: white">
      <div class="layui-tab-item layui-show">
        <div>
          <form action="" method="post" class="layui-form layui-form-pane">
            <div class="layui-form-item">
              <label class="layui-form-label">
                姓名
              </label>
              <div class="layui-input-block">
                <input type="text" id="name" name="name" th:value="${user.name}"
                       lay-verify="required" lay-vertype="tips"
                       autocomplete="off" class="layui-input">
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">
                用户名
              </label>
              <div class="layui-input-block">
                <input type="text" id="userName" name="userName" th:value="${user.userName}"
                       lay-vertype="tips" verify="required"
                       autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">
                手机号
              </label>
              <div class="layui-input-block">
                <input type="text" id="phone" name="phone" th:value="${user.phone}"
                       lay-vertype="tips" lay-verify="required|newmobile"
                       autocomplete="off" class="layui-input">
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">
                性别
              </label>
              <div class="layui-input-block">
                <select name="sex">
                  <option value="男" th:selected="${user.sex=='男'}">男</option>
                  <option value="女" th:selected="${user.sex=='女'}">女</option>
                </select>
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">
                密码
              </label>
              <div class="layui-input-block">
                <input type="password" id="password" name="password"
                       autocomplete="off" class="layui-input">
              </div>
            </div>

            <div class="layui-upload">
              <label class="layui-form-label">
                <span class="x-red">*</span>头像</label>
              <div class="layui-input-inline">
                <button type="button" class="layui-btn" id="test1">头像</button>
                <div class="layui-upload-list">
                  <input type="hidden" id="userImage"  name="userImage" th:value="${user.userImage}"/>
                  <img class="layui-upload-img" id="demo1" width="100px" th:src="${user.userImage}" height="100px">
                  <p id="demoText"></p>
                </div>
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block" style="margin-left:0;text-align:center;">
                <input type="hidden" id="userid" name="userid" th:value="${user.userid}">
                <button class="layui-btn layui-btn-normal btn-w100" lay-submit="" data-th-lay-filter="modifyUserInfo">修改</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="layui-tab-item">
        <div class="layui-tab-item layui-show">
          <div class="img-list">
            <div class="item" th:each="roomOrder:${roomOrderList}" style="margin-bottom: 40px">
              <div class="layui-fluid">
                <div class="layui-row">
                  <div class="layui-col-xs12 layui-col-sm4 layui-col-md3">
                    <div class="img" style="width: 150px;height: 100px;">
                      <img th:if="${roomOrder.room.roomImg!=null and roomOrder.room.roomImg==''}" width="150px" height="100px" th:src="@{/images/moren.jpg}" style="border-radius: 30px">
                      <img th:if="${roomOrder.room.roomImg!=''}" th:src="${roomOrder.room.roomImg }" width="150px" height="100px" style="border-radius: 30px">
                    </div>
                  </div>
                  <div class="layui-col-xs12 layui-col-sm8 layui-col-md9">
                    <div class="item-cont">
                  <span class="layui-btn layui-btn-normal layui-btn-radius"
                        style="height: 20px;line-height: 20px;width: 100px;">[[${roomOrder.room.roomType}]]</span>
                      <span class="layui-btn layui-btn-warm layui-btn-radius"
                            style="height: 20px;line-height: 20px;width: 100px;">[[${roomOrder.status}]]</span>
                      <h3>￥[[${roomOrder.price}]]</h3>
                      <h4>预定时间：[[${roomOrder.startTime}]]~[[${roomOrder.endTime}]]</h4>
                      <h4>[[${#strings.abbreviate(roomOrder.room.roomDesc,80)}]]</h4>
                      <div style="margin-top: 10px" th:if="${roomOrder.status == '已预约'}">
                        <a th:href="${'/front/deleteRoomOrder?id='+roomOrder.id}" class="layui-btn layui-btn-xs layui-btn-warm">取消</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <hr>
            </div>
          </div>

        </div>
      </div>
      <div class="layui-tab-item">
        <div class="layui-tab-item layui-show">
          <div class="img-list">
            <div class="item" th:each="restaurantOrder:${restaurantOrderList}" style="margin-bottom: 40px">
              <div class="layui-fluid">
                <div class="layui-row">
                  <div class="layui-col-xs12 layui-col-sm4 layui-col-md3">
                    <div class="img" style="width: 150px;height: 100px;">
                      <img th:if="${restaurantOrder.restaurant.restImg!=null and restaurantOrder.restaurant.restImg==''}" width="150px" height="100px" th:src="@{/images/moren.jpg}" style="border-radius: 30px">
                      <img th:if="${restaurantOrder.restaurant.restImg!=''}" th:src="${restaurantOrder.restaurant.restImg }" width="150px" height="100px" style="border-radius: 30px">
                    </div>
                  </div>
                  <div class="layui-col-xs12 layui-col-sm8 layui-col-md9">
                    <div class="item-cont">
                  <span class="layui-btn layui-btn-normal layui-btn-radius"
                        style="height: 20px;line-height: 20px;width: 100px;">[[${restaurantOrder.restaurant.name}]]</span>
                      <span class="layui-btn layui-btn-warm layui-btn-radius"
                            style="height: 20px;line-height: 20px;width: 100px;">[[${restaurantOrder.status}]]</span>
                      <h3>￥[[${restaurantOrder.price}]]</h3>
                      <h4>预定时间：[[${restaurantOrder.startTime}]]</h4>
                      <h4>[[${#strings.abbreviate(restaurantOrder.restaurant.restDesc,80)}]]</h4>
                      <div style="margin-top: 10px" th:if="${restaurantOrder.status == '已预约'}">
                        <a th:href="${'/front/deleteRestaurantOrder?id='+restaurantOrder.id}" class="layui-btn layui-btn-xs layui-btn-warm">取消</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <hr>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</div>

<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
  layui.use('element', function(){
    var $ = layui.jquery
            ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

    //触发事件
    var active = {
      tabAdd: function(){
        //新增一个Tab项
        element.tabAdd('demo', {
          title: '新选项'+ (Math.random()*1000|0) //用于演示
          ,content: '内容'+ (Math.random()*1000|0)
          ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
        })
      }
      ,tabDelete: function(othis){
        //删除指定Tab项
        element.tabDelete('demo', '44');
        othis.addClass('layui-btn-disabled');
      }
      ,tabChange: function(){
        //切换到指定Tab项
        element.tabChange('demo', '22');
      }
    };

    $('.site-demo-active').on('click', function(){
      var othis = $(this), type = othis.data('type');
      active[type] ? active[type].call(this, othis) : '';
    });

    //Hash地址的定位
    var layid = location.hash.replace(/^#test=/, '');
    element.tabChange('test', layid);

    element.on('tab(test)', function(elem){
      location.hash = 'test='+ $(this).attr('lay-id');
    });

  });
</script>

<script>
  layui.config({
    base: '/lib/layui/extend/'
  }).extend({
    formSelects: 'formSelects-v4'
  }).use(['form', 'layer','upload', 'formSelects', 'dtree'], function () {
    $ = layui.jquery;
    var form = layui.form
            , layer = layui.layer
            , formSelects = layui.formSelects
            , upload=layui.upload;

    form.on('submit(modifyUserInfo)', function (form) {
      $.post('/user/update', form.field, function (result) {
        handlerResult(result, editDone);
      });
      return false;
    });

    function addDone(data) {
      layer.msg("添加成功", {icon: 6});
    }

    function editDone(data) {
      layer.msg("修改成功", {icon: 6});
      window.location.href='/login'
    }

    //普通图片上传
    var uploadInst = upload.render({
      elem: '#test1'
      , url: "/front/album/upFile"
      , before: function (obj) {
        //预读本地文件示例，不支持ie8
        obj.preview(function (index, file, result) {
          $('#demo1').attr('src', result); //图片链接（base64）
        });
      }
      , done: function (res) {
        //如果上传失败
        if (res.code > 0) {
          return layer.msg('上传失败');
        }
        //上传成功
        else {
          $("#userImage").val(res.data.src); //提交时注册的时候用 写入数据库
          // layer.msg('上传成功'+photo_path);
          layer.msg('上传成功');
        }
      }
      , error: function () {
        //演示失败状态，并实现重传
        var demoText = $('#demoText');
        demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
        demoText.find('.demo-reload').on('click', function () {
          uploadInst.upload();
        });
      }
    });

    //普通图片上传
    var uploadInst2 = upload.render({
      elem: '#test2'
      , url: "/pet/image"
      , before: function (obj) {
        //预读本地文件示例，不支持ie8
        obj.preview(function (index, file, result) {
          $('#demo2').attr('src', result); //图片链接（base64）
        });
      }
      , done: function (res) {
        //如果上传失败
        if (res.code > 0) {
          return layer.msg('上传失败');
        }
        //上传成功
        else {
          $("#petImage").val(res.data.src); //提交时注册的时候用 写入数据库
          // layer.msg('上传成功'+photo_path);
          layer.msg('上传成功');
        }
      }
      , error: function () {
        //演示失败状态，并实现重传
        var demoText2 = $('#demoText2');
        demoText2.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
        demoText2.find('.demo-reload').on('click', function () {
          uploadInst2.upload();
        });
      }
    });
  });

  function feedback() {
    $('#shangchan').click();
  }

  function uploadImg(petId){
    var formdata = new FormData();
    formdata.append('file',$("#shangchan")[0].files[0]); //获取图片信息
    formdata.append('petId',petId);
    $.ajax({
      url : "/feedback/image",
      type : 'post',
      data:formdata,
      cache:false,
      dataType:'json',
      processData:false,
      contentType:false,
      success : function (e){
        alert("反馈成功");
      }
    });
  }

  function appointment(petId){
    var formdata = new FormData();
    formdata.append('petId',petId);
    $.ajax({
      url : "/appointment/",
      type : 'post',
      data:formdata,
      cache:false,
      dataType:'json',
      processData:false,
      contentType:false,
      success : function (e){
        alert(e.msg);
      }
    });
  }

  function exchange(){
    $.ajax({
      url : "/exchange",
      type : 'post',
      cache:false,
      dataType:'json',
      processData:false,
      contentType:false,
      success : function (e){
        alert(e.msg);
      }
    });
  }
</script>

</body>
</html>